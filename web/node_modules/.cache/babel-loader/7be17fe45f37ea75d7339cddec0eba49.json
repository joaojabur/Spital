{"ast":null,"code":"var _jsxFileName = \"C:\\\\Projetos\\\\Spital\\\\web\\\\src\\\\platform-pages\\\\AddCreditCard\\\\index.tsx\",\n    _s = $RefreshSig$();\n\nimport { Button, TextField } from \"@material-ui/core\";\nimport React, { useEffect, useState } from \"react\";\nimport { useHistory } from \"react-router\";\nimport SubHeaderPlatform from \"../../components/SubHeaderPlatform\";\nimport \"./styles.css\";\nimport creditCard from \"../../assets/images/icons/credit-card.png\";\nimport mask from \"../../utils/mask\";\nimport validateCard from \"../../utils/validateCard\";\nimport { useModal } from \"../../context/ModalProvider\";\nimport api from \"../../services/api\";\nimport { useAuth } from \"../../context/AuthProvider\";\nimport Loader from \"react-loader-spinner\";\nimport { IoTrashOutline } from \"react-icons/io5\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst pagarme = require(\"pagarme\");\n\nconst AddCreditCard = () => {\n  _s();\n\n  var _cards$, _cards$$card;\n\n  const {\n    sucesso,\n    areYouSure\n  } = useModal();\n  const {\n    userID\n  } = useAuth();\n  const [pagarmeError, setPagarmeError] = useState(\"\");\n  const [cards, setCards] = useState([]);\n  const [loading, setLoading] = useState(false);\n  useEffect(() => {\n    setLoading(true);\n    api.get(`cards?userID=${userID}`).then(response => {\n      setCards(response.data);\n      setLoading(false);\n    });\n  }, [userID]);\n  const history = useHistory();\n  const [card, setCard] = useState({\n    card_number: \"\",\n    card_holder_name: \"\",\n    card_expiration_date: \"\",\n    card_cvv: \"\",\n    client_id: \"\"\n  });\n  const [errors, setErrors] = useState(validateCard(card));\n  const [hasError, setHasError] = useState(false);\n\n  function validate() {\n    setErrors(validateCard(card));\n  }\n\n  const cardValidation = pagarme.validate({\n    card\n  });\n\n  async function submitHandleFormCard(e) {\n    setLoading(true);\n    e.preventDefault();\n    const loopedErrors = Object.values(errors);\n\n    if (loopedErrors.length > 0) {\n      setHasError(true);\n      setPagarmeError(\"\");\n      setLoading(false);\n    } else if (cards.length > 0) {\n      setPagarmeError(\"Não é possível cadastrar mais de um cartão\");\n      setLoading(false);\n    } else if (cardValidation.card.card_holder_name === false) {\n      setPagarmeError(\"Nome no cartão inválido\");\n      setHasError(false);\n      setLoading(false);\n    } else if (cardValidation.card.card_number === false) {\n      setPagarmeError(\"Número do cartão inválido\");\n      setHasError(false);\n      setLoading(false);\n    } else if (cardValidation.card.card_expiration_date === false) {\n      setPagarmeError(\"Data de expiração inválida\");\n      setHasError(false);\n      setLoading(false);\n    } else if (cardValidation.card.card_cvv === false) {\n      setPagarmeError(\"CVV inválido\");\n      setHasError(false);\n      setLoading(false);\n    } else {\n      setPagarmeError(\"\");\n      setHasError(false); //const card_number_without_space = card.card_number.replace(/[ ]/g, \"\");\n      //const card_expiration_date_withou_slash =\n      //card.card_expiration_date.replace(/[/]/g, \"\");\n\n      await pagarme.client.connect({\n        encryption_key: \"ek_live_umV8Rv1MmMupcC0lorpGrAYo0j3ifN\"\n      }).then(client => client.security.encrypt(card)).then(card_hash => {\n        console.log(card_hash);\n        api.post(`cards?userID=${userID}`, {\n          card_hash\n        });\n        setLoading(false);\n        window.location.reload();\n      });\n      await sucesso.open({\n        name: \"Cartão cadastrado com sucesso!\",\n        close: () => {\n          sucesso.close();\n        },\n        description: \"Método de pagamento adicionado.\"\n      });\n    }\n  }\n\n  useEffect(() => {\n    setErrors(validateCard(card));\n  }, [card]);\n\n  function SureFunction() {\n    setLoading(true);\n    api.delete(`cards/${cards[0].id}`).then(response => {\n      console.log(response);\n      setLoading(false);\n      window.location.reload();\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"add-credit-card\",\n    children: [/*#__PURE__*/_jsxDEV(SubHeaderPlatform, {\n      title: \"Cadastrar cart\\xE3o\",\n      returnFunction: () => {\n        history.replace(\"/\");\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: submitHandleFormCard,\n      id: \"add-credit-card-form\",\n      className: \"form-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Dados do cart\\xE3o de cr\\xE9dito\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"line\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(TextField, {\n        placeholder: \"1111 2222 3333 4444\",\n        value: card === null || card === void 0 ? void 0 : card.card_number,\n        name: \"card_number\",\n        label: /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            fontSize: \"1.5rem\"\n          },\n          children: \"N\\xFAmero do cart\\xE3o\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 18\n        }, this),\n        variant: \"outlined\",\n        fullWidth: true,\n        onChange: e => {\n          setCard({ ...card,\n            card_number: mask(e.target.value, \"#### #### #### ####\")\n          });\n          validate();\n        },\n        autoComplete: \"off\",\n        required: true,\n        error: errors.card_number ? true : false,\n        helperText: /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            fontSize: \"1.5rem\"\n          },\n          children: errors.card_number\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-credit-card-form\",\n        children: [/*#__PURE__*/_jsxDEV(TextField, {\n          value: card === null || card === void 0 ? void 0 : card.card_expiration_date,\n          name: \"card_expiration_date\",\n          label: /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              fontSize: \"1.5rem\"\n            },\n            children: \"Data de validade\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 20\n          }, this),\n          variant: \"outlined\",\n          style: {\n            width: \"49%\"\n          },\n          onChange: e => {\n            setCard({ ...card,\n              card_expiration_date: mask(e.target.value, \"##/##\")\n            });\n            validate();\n          },\n          autoComplete: \"off\",\n          required: true,\n          error: errors.card_expiration_date ? true : false,\n          helperText: /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              fontSize: \"1.5rem\"\n            },\n            children: errors.card_expiration_date\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(TextField, {\n          value: card === null || card === void 0 ? void 0 : card.card_cvv,\n          name: \"firstName\",\n          label: /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              fontSize: \"1.5rem\"\n            },\n            children: \"CVV\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 20\n          }, this),\n          variant: \"outlined\",\n          style: {\n            width: \"49%\"\n          },\n          onChange: e => {\n            setCard({ ...card,\n              card_cvv: mask(e.target.value, \"###\")\n            });\n            validate();\n          },\n          autoComplete: \"off\",\n          required: true,\n          error: errors.card_cvv ? true : false,\n          helperText: /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              fontSize: \"1.5rem\"\n            },\n            children: errors.card_cvv\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(TextField, {\n        value: card === null || card === void 0 ? void 0 : card.card_holder_name,\n        name: \"firstName\",\n        label: /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            fontSize: \"1.5rem\"\n          },\n          children: \"Nome no cart\\xE3o\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 18\n        }, this),\n        variant: \"outlined\",\n        fullWidth: true,\n        style: {\n          marginTop: \"1rem\"\n        },\n        onChange: e => {\n          setCard({ ...card,\n            card_holder_name: e.target.value\n          });\n          validate();\n        },\n        autoComplete: \"off\",\n        required: true,\n        error: errors.card_holder_name ? true : false,\n        helperText: /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            fontSize: \"1.5rem\"\n          },\n          children: errors.card_holder_name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 9\n      }, this), hasError && /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          marginTop: \"2rem\",\n          fontSize: \"1.5rem\"\n        },\n        children: \"Formul\\xE1rio possui erros\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          marginTop: \"2rem\",\n          fontSize: \"1.5rem\",\n          color: \"#f00\"\n        },\n        children: pagarmeError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 9\n      }, this), loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: \"flex\",\n          alignItems: \"center\",\n          width: \"100%\",\n          justifyContent: \"center\"\n        },\n        children: /*#__PURE__*/_jsxDEV(Loader, {\n          type: \"TailSpin\",\n          color: \"var(--color-button-primary)\",\n          height: 70,\n          width: 70\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        className: \"primary\",\n        children: \"Cadastrar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }, this), (cards === null || cards === void 0 ? void 0 : cards.length) && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"registered-cards\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        children: \"Cart\\xE3o cadastrado:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"registered-cards-flex\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"registered-cards-flex-unique\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: creditCard,\n            alt: \"Cart\\xE3o\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 258,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"Terminado em \", (_cards$ = cards[0]) === null || _cards$ === void 0 ? void 0 : (_cards$$card = _cards$.card) === null || _cards$$card === void 0 ? void 0 : _cards$$card.last_digits]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: () => {\n            areYouSure.open({\n              message: \"Certeza que deseja deletar seu cartão?\",\n              sureFunction: () => {\n                SureFunction();\n              },\n              close: () => {\n                areYouSure.close();\n              }\n            });\n          },\n          style: {\n            outline: 0,\n            border: 0\n          },\n          children: /*#__PURE__*/_jsxDEV(IoTrashOutline, {\n            color: \"#f00\",\n            size: 30\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 256,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 121,\n    columnNumber: 5\n  }, this);\n};\n\n_s(AddCreditCard, \"bSTf1FGQfGGsQU+KXi5qYfa5rUI=\", false, function () {\n  return [useModal, useAuth, useHistory];\n});\n\n_c = AddCreditCard;\nexport default AddCreditCard;\n\nvar _c;\n\n$RefreshReg$(_c, \"AddCreditCard\");","map":{"version":3,"sources":["C:/Projetos/Spital/web/src/platform-pages/AddCreditCard/index.tsx"],"names":["Button","TextField","React","useEffect","useState","useHistory","SubHeaderPlatform","creditCard","mask","validateCard","useModal","api","useAuth","Loader","IoTrashOutline","pagarme","require","AddCreditCard","sucesso","areYouSure","userID","pagarmeError","setPagarmeError","cards","setCards","loading","setLoading","get","then","response","data","history","card","setCard","card_number","card_holder_name","card_expiration_date","card_cvv","client_id","errors","setErrors","hasError","setHasError","validate","cardValidation","submitHandleFormCard","e","preventDefault","loopedErrors","Object","values","length","client","connect","encryption_key","security","encrypt","card_hash","console","log","post","window","location","reload","open","name","close","description","SureFunction","delete","id","replace","fontSize","target","value","width","marginTop","color","display","alignItems","justifyContent","last_digits","message","sureFunction","outline","border"],"mappings":"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","sourcesContent":["import { Button, TextField } from \"@material-ui/core\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useHistory } from \"react-router\";\r\nimport SubHeaderPlatform from \"../../components/SubHeaderPlatform\";\r\nimport \"./styles.css\";\r\nimport creditCard from \"../../assets/images/icons/credit-card.png\";\r\nimport mask from \"../../utils/mask\";\r\nimport validateCard from \"../../utils/validateCard\";\r\nimport { useModal } from \"../../context/ModalProvider\";\r\nimport api from \"../../services/api\";\r\nimport { useAuth } from \"../../context/AuthProvider\";\r\nimport Loader from \"react-loader-spinner\";\r\nimport { IoTrashOutline } from \"react-icons/io5\";\r\nconst pagarme = require(\"pagarme\");\r\n\r\nconst AddCreditCard = () => {\r\n  const { sucesso, areYouSure } = useModal();\r\n  const { userID } = useAuth();\r\n  const [pagarmeError, setPagarmeError] = useState(\"\");\r\n  const [cards, setCards] = useState<any>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n    api.get(`cards?userID=${userID}`).then((response: any) => {\r\n      setCards(response.data);\r\n      setLoading(false);\r\n    });\r\n  }, [userID]);\r\n\r\n  const history = useHistory();\r\n  const [card, setCard] = useState({\r\n    card_number: \"\",\r\n    card_holder_name: \"\",\r\n    card_expiration_date: \"\",\r\n    card_cvv: \"\",\r\n    client_id: \"\",\r\n  });\r\n  const [errors, setErrors] = useState(validateCard(card));\r\n  const [hasError, setHasError] = useState(false);\r\n\r\n  function validate() {\r\n    setErrors(validateCard(card));\r\n  }\r\n\r\n  const cardValidation = pagarme.validate({ card });\r\n\r\n  async function submitHandleFormCard(e: any) {\r\n    setLoading(true);\r\n    e.preventDefault();\r\n    const loopedErrors = Object.values(errors);\r\n\r\n    if (loopedErrors.length > 0) {\r\n      setHasError(true);\r\n      setPagarmeError(\"\");\r\n      setLoading(false);\r\n    } else if (cards.length > 0) {\r\n      setPagarmeError(\"Não é possível cadastrar mais de um cartão\");\r\n      setLoading(false);\r\n    } else if (cardValidation.card.card_holder_name === false) {\r\n      setPagarmeError(\"Nome no cartão inválido\");\r\n      setHasError(false);\r\n      setLoading(false);\r\n    } else if (cardValidation.card.card_number === false) {\r\n      setPagarmeError(\"Número do cartão inválido\");\r\n      setHasError(false);\r\n      setLoading(false);\r\n    } else if (cardValidation.card.card_expiration_date === false) {\r\n      setPagarmeError(\"Data de expiração inválida\");\r\n      setHasError(false);\r\n      setLoading(false);\r\n    } else if (cardValidation.card.card_cvv === false) {\r\n      setPagarmeError(\"CVV inválido\");\r\n      setHasError(false);\r\n      setLoading(false);\r\n    } else {\r\n      setPagarmeError(\"\");\r\n      setHasError(false);\r\n      //const card_number_without_space = card.card_number.replace(/[ ]/g, \"\");\r\n      //const card_expiration_date_withou_slash =\r\n      //card.card_expiration_date.replace(/[/]/g, \"\");\r\n\r\n      await pagarme.client\r\n        .connect({\r\n          encryption_key: \"ek_live_umV8Rv1MmMupcC0lorpGrAYo0j3ifN\",\r\n        })\r\n        .then((client: any) => client.security.encrypt(card))\r\n        .then((card_hash: any) => {\r\n          console.log(card_hash);\r\n          api.post(`cards?userID=${userID}`, {\r\n            card_hash,\r\n          });\r\n          setLoading(false);\r\n          window.location.reload();\r\n        });\r\n\r\n      await sucesso.open({\r\n        name: \"Cartão cadastrado com sucesso!\",\r\n        close: () => {\r\n          sucesso.close();\r\n        },\r\n        description: \"Método de pagamento adicionado.\",\r\n      });\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    setErrors(validateCard(card));\r\n  }, [card]);\r\n\r\n  function SureFunction() {\r\n    setLoading(true);\r\n    api.delete(`cards/${cards[0].id}`).then((response) => {\r\n      console.log(response);\r\n      setLoading(false);\r\n      window.location.reload();\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div className=\"add-credit-card\">\r\n      <SubHeaderPlatform\r\n        title=\"Cadastrar cartão\"\r\n        returnFunction={() => {\r\n          history.replace(\"/\");\r\n        }}\r\n      />\r\n      <form\r\n        onSubmit={submitHandleFormCard}\r\n        id=\"add-credit-card-form\"\r\n        className=\"form-container\"\r\n      >\r\n        <h2>Dados do cartão de crédito</h2>\r\n        <div className=\"line\"></div>\r\n        <TextField\r\n          placeholder=\"1111 2222 3333 4444\"\r\n          value={card?.card_number}\r\n          name=\"card_number\"\r\n          label={<span style={{ fontSize: \"1.5rem\" }}>Número do cartão</span>}\r\n          variant=\"outlined\"\r\n          fullWidth\r\n          onChange={(e) => {\r\n            setCard({\r\n              ...card,\r\n              card_number: mask(e.target.value, \"#### #### #### ####\"),\r\n            });\r\n            validate();\r\n          }}\r\n          autoComplete=\"off\"\r\n          required\r\n          error={errors.card_number ? true : false}\r\n          helperText={\r\n            <span style={{ fontSize: \"1.5rem\" }}>{errors.card_number}</span>\r\n          }\r\n        />\r\n\r\n        <div className=\"flex-credit-card-form\">\r\n          <TextField\r\n            value={card?.card_expiration_date}\r\n            name=\"card_expiration_date\"\r\n            label={<span style={{ fontSize: \"1.5rem\" }}>Data de validade</span>}\r\n            variant=\"outlined\"\r\n            style={{ width: \"49%\" }}\r\n            onChange={(e) => {\r\n              setCard({\r\n                ...card,\r\n                card_expiration_date: mask(e.target.value, \"##/##\"),\r\n              });\r\n              validate();\r\n            }}\r\n            autoComplete=\"off\"\r\n            required\r\n            error={errors.card_expiration_date ? true : false}\r\n            helperText={\r\n              <span style={{ fontSize: \"1.5rem\" }}>\r\n                {errors.card_expiration_date}\r\n              </span>\r\n            }\r\n          />\r\n\r\n          <TextField\r\n            value={card?.card_cvv}\r\n            name=\"firstName\"\r\n            label={<span style={{ fontSize: \"1.5rem\" }}>CVV</span>}\r\n            variant=\"outlined\"\r\n            style={{ width: \"49%\" }}\r\n            onChange={(e) => {\r\n              setCard({ ...card, card_cvv: mask(e.target.value, \"###\") });\r\n              validate();\r\n            }}\r\n            autoComplete=\"off\"\r\n            required\r\n            error={errors.card_cvv ? true : false}\r\n            helperText={\r\n              <span style={{ fontSize: \"1.5rem\" }}>{errors.card_cvv}</span>\r\n            }\r\n          />\r\n        </div>\r\n        <TextField\r\n          value={card?.card_holder_name}\r\n          name=\"firstName\"\r\n          label={<span style={{ fontSize: \"1.5rem\" }}>Nome no cartão</span>}\r\n          variant=\"outlined\"\r\n          fullWidth\r\n          style={{ marginTop: \"1rem\" }}\r\n          onChange={(e) => {\r\n            setCard({ ...card, card_holder_name: e.target.value });\r\n            validate();\r\n          }}\r\n          autoComplete=\"off\"\r\n          required\r\n          error={errors.card_holder_name ? true : false}\r\n          helperText={\r\n            <span style={{ fontSize: \"1.5rem\" }}>\r\n              {errors.card_holder_name}\r\n            </span>\r\n          }\r\n        />\r\n\r\n        {hasError && (\r\n          <span style={{ marginTop: \"2rem\", fontSize: \"1.5rem\" }}>\r\n            Formulário possui erros\r\n          </span>\r\n        )}\r\n\r\n        <span style={{ marginTop: \"2rem\", fontSize: \"1.5rem\", color: \"#f00\" }}>\r\n          {pagarmeError}\r\n        </span>\r\n\r\n        {loading ? (\r\n          <div\r\n            style={{\r\n              display: \"flex\",\r\n              alignItems: \"center\",\r\n              width: \"100%\",\r\n              justifyContent: \"center\",\r\n            }}\r\n          >\r\n            <Loader\r\n              type=\"TailSpin\"\r\n              color=\"var(--color-button-primary)\"\r\n              height={70}\r\n              width={70}\r\n            />\r\n          </div>\r\n        ) : (\r\n          <button type=\"submit\" className=\"primary\">\r\n            Cadastrar\r\n          </button>\r\n        )}\r\n      </form>\r\n\r\n      {cards?.length && (\r\n        <div className=\"registered-cards\">\r\n          <h1>Cartão cadastrado:</h1>\r\n          <div className=\"registered-cards-flex\">\r\n            <div className=\"registered-cards-flex-unique\">\r\n              <img src={creditCard} alt=\"Cartão\" />\r\n              <span>Terminado em {cards[0]?.card?.last_digits}</span>\r\n            </div>\r\n\r\n            <Button\r\n              onClick={() => {\r\n                areYouSure.open({\r\n                  message: \"Certeza que deseja deletar seu cartão?\",\r\n                  sureFunction: () => {\r\n                    SureFunction();\r\n                  },\r\n                  close: () => {\r\n                    areYouSure.close();\r\n                  },\r\n                });\r\n              }}\r\n              style={{ outline: 0, border: 0 }}\r\n            >\r\n              <IoTrashOutline color=\"#f00\" size={30} />\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AddCreditCard;\r\n"]},"metadata":{},"sourceType":"module"}